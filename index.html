<!doctype html>
<html>
<head>
<title>Bootstrap icon finder</title>
<link href="css/bootstrap.css" rel="stylesheet" type="text/css">
<link href="css/styles.css" rel="stylesheet" type="text/css">
</head>

<body>
<div class="container">
	<div class="page-header">
		<h1>Bootstrap icon finder</h1>
	</div>

	<form class="form-search">
		<input id="search" type="search" class="input-block-level search-query">
	</form>

	<ul id="icons" class='ul-icon-list'></ul>
</div>
<script src="js/icon-sets.js"></script>
<script src="js/filter.js"></script>
<script type="text/javascript">
(function(w, d) {
	var searchEl = d.getElementById('search');
	var iconEl = d.getElementById('icons');

	var iconSet = ICONS['bootstrap'];
	var i, span, iconLabel;

	var selectThis = function() {
		if (document.selection) {
			var range = document.body.createTextRange();
			range.moveToElementText(this);
			range.select();
		} else if (window.getSelection) {
			var range = document.createRange();
			range.selectNode(this);
			window.getSelection().addRange(range);
		}
	};

	// construct icons
	console.log(iconSet, iconSet.icons);
	for (iconName in iconSet.icons) {
		iconLabel = document.createElement('li');

		i = document.createElement('i');
		i.className = iconName;

		span = document.createElement('span');
		span.appendChild(document.createTextNode(iconName));
		span.addEventListener('click', selectThis);

		iconLabel.appendChild(i);
		iconLabel.appendChild(span);
		iconLabel.dataset['iconName'] = iconName;
		
		// Add base64 encoding to click event
		iconLabel.addEventListener('click', function() {
			var icon = this.getElementsByTagName('i')[0];
			var bp = w.getComputedStyle(icon).getPropertyValue('background-position');
			
			bp = bp.split(" ");

			var x = parseFloat(bp[0]);
			var y = parseFloat(bp[1]);
			
			window.location = encodeIcon(x, y);
		});

		iconEl.appendChild(iconLabel);
	}

	// add event listeners
	var change = function() {
		var value = searchEl.value;
		console.log("Searching for", value);
		var searchResults = search(iconSet.icons, value);
		console.log(searchResults);

		for (var i = 0, l = iconEl.childNodes.length, child, iconName; i < l; i++) {
			child = iconEl.childNodes[i];
			iconName = child.dataset['iconName'];
			if (searchResults[iconName]) {
				child.classList.remove('hidden');
			} else {
				child.classList.add('hidden');
			}
		}
	};
	searchEl.addEventListener('change', change);
	searchEl.addEventListener('keyup', change);
	searchEl.addEventListener('blur', change);
	searchEl.addEventListener('focus', change);

	// do search
	change();
	
	
	// Base 64 icon encoding
	var c = d.createElement('canvas'),
		cx = c.getContext('2d'),
		b = d.getElementsByTagName('body')[0],
		img = new Image(),
		p = d.getElementById('code');

	c.width = 14;
	c.height = 14;

	img.src = 'img/glyphicons-halflings.png';

	function encodeIcon(x, y) {
		cx.drawImage(img, x, y);
		return c.toDataURL();
	}

})(window, document);
</script>
<script type="text/javascript">
/* This needs to be in the <head>, otherwise it gets printed out! */

(function(){
	var domain = 'maelstrom.github.com';

	function woopraReady(tracker){
		tracker.setDomain(domain);
		tracker.setIdleTimeout(300000);
		tracker.addVisitorProperty('project','bootstrap-icon-search');
		tracker.track();
		return false;
	}

	if (location.host == domain) {
		window.woopraReady = woopraReady;

		var wsc=document.createElement('script');
		wsc.type='text/javascript';
		wsc.src=document.location.protocol+'//static.woopra.com/js/woopra.js';
		wsc.async=true;
		var ssc = document.getElementsByTagName('script')[0];
		ssc.parentNode.insertBefore(wsc, ssc);
	};
})();
</script>
</body>
</html>
